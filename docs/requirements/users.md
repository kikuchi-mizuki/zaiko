# ユーザーと権限

## ユーザー種別

### 店舗マネージャー

**権限**:

- 自店舗の追加発注依頼
- 自店舗の依頼状況確認
- 在庫照会（数量のみ。納品日は別途連絡）

**登録方法**:

1. LINE友だち追加
2. 初回メッセージで店舗選択
3. 自動登録（`line_users` テーブルに追加）

### 本部バイヤー

**権限**:

- 全店舗の発注承認/差戻し/一部承認
- 全依頼状況の確認

**操作環境**:

- 管理画面（PC）
- LINE（モバイル）
- 両方から同じ操作が可能

**登録方法**:

1. 管理者から招待コードを受け取る
2. LINEで招待コード入力
3. 自動登録（`role='buyer'`）

### 貴社管理者（運用管理）

**権限**:

- 全データ閲覧・修正
- 在庫Excel アップロード
- 暫定在庫使用時の承認
- 仮引当の手動解放・期限延長
- 強制確定/取消

**操作環境**:

- 管理画面（主）
- LINE（通知受信）

### 加工会社

**権限**（Phase1では最低限）:

- 出荷依頼の受領
- 出荷ステータス更新（shipped + tracking番号入力）

**操作環境**:

- 通知受領方法は後日確定（LINE/メール/管理画面）
- 出荷報告は管理画面を想定

## 権限マトリクス

| 機能 | 店舗 | 本部 | 管理者 | 加工会社 |
|------|------|------|--------|----------|
| 在庫照会 | ✅ | ✅ | ✅ | - |
| 追加発注 | ✅ | - | ✅ | - |
| 本部承認 | - | ✅ | ✅ | - |
| 在庫修正 | - | - | ✅ | - |
| Excel アップロード | - | - | ✅ | - |
| 出荷報告 | - | - | ✅ | ✅ |

## 招待コード管理

### 発行
- 管理者が管理画面で発行
- 有効期限設定可能（デフォルト: 7日間）
- 1回限り使用

### 利用フロー
```
1. 管理者: コード発行（例: BUYER-ABC123）
2. 管理者 → 本部バイヤー: コードを共有
3. 本部バイヤー: LINEで「招待コード: BUYER-ABC123」と送信
4. システム: 自動で line_users に登録
5. コード無効化（used_at 記録）
```
